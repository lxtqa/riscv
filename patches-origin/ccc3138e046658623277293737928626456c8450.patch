From ccc3138e046658623277293737928626456c8450 Mon Sep 17 00:00:00 2001
From: Lu Yahan <yahan@iscas.ac.cn>
Date: Tue, 9 Aug 2022 11:11:04 +0800
Subject: [PATCH] [riscv] Fix wasm/externref-globals-liftoff failed

Change-Id: I4671a704fc76063a64ed90c337770ec17fe8e393
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/3815778
Commit-Queue: Yahan Lu <yahan@iscas.ac.cn>
Reviewed-by: Andreas Haas <ahaas@chromium.org>
Auto-Submit: Yahan Lu <yahan@iscas.ac.cn>
Cr-Commit-Position: refs/heads/main@{#82281}
---
 src/wasm/baseline/riscv/liftoff-assembler-riscv32.h | 4 ++--
 test/mjsunit/mjsunit.status                         | 2 --
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/src/wasm/baseline/riscv/liftoff-assembler-riscv32.h b/src/wasm/baseline/riscv/liftoff-assembler-riscv32.h
index b8f463fc6f..9625f4ae7c 100644
--- a/src/wasm/baseline/riscv/liftoff-assembler-riscv32.h
+++ b/src/wasm/baseline/riscv/liftoff-assembler-riscv32.h
@@ -221,13 +221,13 @@ void LiftoffAssembler::StoreTaggedPointer(Register dst_addr,
 
   Label write_barrier;
   Label exit;
-  CheckPageFlag(dst_addr, scratch,
+  CheckPageFlag(dst_addr, kScratchReg,
                 MemoryChunk::kPointersFromHereAreInterestingMask, ne,
                 &write_barrier);
   Branch(&exit);
   bind(&write_barrier);
   JumpIfSmi(src.gp(), &exit);
-  CheckPageFlag(src.gp(), scratch,
+  CheckPageFlag(src.gp(), kScratchReg,
                 MemoryChunk::kPointersToHereAreInterestingMask, eq, &exit);
   AddWord(scratch, dst_op.rm(), dst_op.offset());
   CallRecordWriteStubSaveRegisters(dst_addr, scratch, SaveFPRegsMode::kSave,
diff --git a/test/mjsunit/mjsunit.status b/test/mjsunit/mjsunit.status
index fe2684bf56..f81a9473b9 100644
--- a/test/mjsunit/mjsunit.status
+++ b/test/mjsunit/mjsunit.status
@@ -926,8 +926,6 @@
 'wasm/generic-wrapper':[SKIP],
 'wasm/many-parameters':[SKIP],
 'wasm/compare-exchange64-stress':[SKIP],
-'wasm/externref-globals-liftoff':['variant == stress_incremental_marking', SKIP],
-'wasm/stringrefs-js':['variant == stress_incremental_marking', SKIP],
 }], # 'arch == riscv32'
 
 ##############################################################################
-- 
2.35.1

