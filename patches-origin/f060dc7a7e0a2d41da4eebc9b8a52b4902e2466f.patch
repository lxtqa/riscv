From f060dc7a7e0a2d41da4eebc9b8a52b4902e2466f Mon Sep 17 00:00:00 2001
From: Dan Elphick <delphick@chromium.org>
Date: Thu, 22 Jul 2021 20:21:08 +0100
Subject: [PATCH] [Build] Remove includes in pointer-authentication headers
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Replaces includes of v8.h with more fine-grained includes and moves the
deoptimizer.h include to the places that actually need it.

Bug: v8:11879
Change-Id: Ifc2e89caf455ddcf559fdb449d0fed7ad0d046d9
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/3045706
Reviewed-by: Simon ZÃ¼nd <szuend@chromium.org>
Commit-Queue: Dan Elphick <delphick@chromium.org>
Cr-Commit-Position: refs/heads/master@{#75873}
---
 src/codegen/arm/macro-assembler-arm.cc             | 1 +
 src/codegen/mips/macro-assembler-mips.cc           | 1 +
 src/codegen/mips64/macro-assembler-mips64.cc       | 1 +
 src/codegen/ppc/macro-assembler-ppc.cc             | 1 +
 src/codegen/riscv64/macro-assembler-riscv64.cc     | 1 +
 src/codegen/s390/macro-assembler-s390.cc           | 1 +
 src/codegen/x64/macro-assembler-x64.cc             | 1 +
 src/debug/debug-frames.cc                          | 1 +
 src/execution/arm64/pointer-authentication-arm64.h | 4 ++--
 src/execution/pointer-authentication-dummy.h       | 6 ++----
 src/execution/pointer-authentication.h             | 3 +--
 src/objects/feedback-vector.cc                     | 1 +
 src/runtime/runtime-debug.cc                       | 1 +
 13 files changed, 15 insertions(+), 8 deletions(-)

diff --git a/src/codegen/arm/macro-assembler-arm.cc b/src/codegen/arm/macro-assembler-arm.cc
index 49cb9d292ca..57bce6ed2d7 100644
--- a/src/codegen/arm/macro-assembler-arm.cc
+++ b/src/codegen/arm/macro-assembler-arm.cc
@@ -18,6 +18,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/mips/macro-assembler-mips.cc b/src/codegen/mips/macro-assembler-mips.cc
index c197d8e6f3a..9c41d165576 100644
--- a/src/codegen/mips/macro-assembler-mips.cc
+++ b/src/codegen/mips/macro-assembler-mips.cc
@@ -16,6 +16,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/mips64/macro-assembler-mips64.cc b/src/codegen/mips64/macro-assembler-mips64.cc
index a2e37bd9af2..0d79efc4fb3 100644
--- a/src/codegen/mips64/macro-assembler-mips64.cc
+++ b/src/codegen/mips64/macro-assembler-mips64.cc
@@ -16,6 +16,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/ppc/macro-assembler-ppc.cc b/src/codegen/ppc/macro-assembler-ppc.cc
index 5ac7d35d8ac..578f1d5f5ce 100644
--- a/src/codegen/ppc/macro-assembler-ppc.cc
+++ b/src/codegen/ppc/macro-assembler-ppc.cc
@@ -16,6 +16,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/riscv64/macro-assembler-riscv64.cc b/src/codegen/riscv64/macro-assembler-riscv64.cc
index 351da937585..a92e43899f5 100644
--- a/src/codegen/riscv64/macro-assembler-riscv64.cc
+++ b/src/codegen/riscv64/macro-assembler-riscv64.cc
@@ -16,6 +16,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/s390/macro-assembler-s390.cc b/src/codegen/s390/macro-assembler-s390.cc
index 87aea0fa2c0..731009eb621 100644
--- a/src/codegen/s390/macro-assembler-s390.cc
+++ b/src/codegen/s390/macro-assembler-s390.cc
@@ -16,6 +16,7 @@
 #include "src/codegen/macro-assembler.h"
 #include "src/codegen/register-configuration.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/codegen/x64/macro-assembler-x64.cc b/src/codegen/x64/macro-assembler-x64.cc
index f4a524c029f..f655e9e71b2 100644
--- a/src/codegen/x64/macro-assembler-x64.cc
+++ b/src/codegen/x64/macro-assembler-x64.cc
@@ -21,6 +21,7 @@
 #include "src/common/external-pointer.h"
 #include "src/common/globals.h"
 #include "src/debug/debug.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 #include "src/heap/memory-chunk.h"
 #include "src/init/bootstrapper.h"
diff --git a/src/debug/debug-frames.cc b/src/debug/debug-frames.cc
index 099c31e6ef3..bcb8da66527 100644
--- a/src/debug/debug-frames.cc
+++ b/src/debug/debug-frames.cc
@@ -5,6 +5,7 @@
 #include "src/debug/debug-frames.h"
 
 #include "src/builtins/accessors.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/frames-inl.h"
 
 #if V8_ENABLE_WEBASSEMBLY
diff --git a/src/execution/arm64/pointer-authentication-arm64.h b/src/execution/arm64/pointer-authentication-arm64.h
index 6af8974788c..3ac184ee726 100644
--- a/src/execution/arm64/pointer-authentication-arm64.h
+++ b/src/execution/arm64/pointer-authentication-arm64.h
@@ -5,10 +5,10 @@
 #ifndef V8_EXECUTION_ARM64_POINTER_AUTHENTICATION_ARM64_H_
 #define V8_EXECUTION_ARM64_POINTER_AUTHENTICATION_ARM64_H_
 
-#include "src/execution/pointer-authentication.h"
-
 #include "src/common/globals.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/arm64/simulator-arm64.h"
+#include "src/execution/pointer-authentication.h"
 
 namespace v8 {
 namespace internal {
diff --git a/src/execution/pointer-authentication-dummy.h b/src/execution/pointer-authentication-dummy.h
index 9948d8303dc..4a19f41fbfe 100644
--- a/src/execution/pointer-authentication-dummy.h
+++ b/src/execution/pointer-authentication-dummy.h
@@ -5,11 +5,9 @@
 #ifndef V8_EXECUTION_POINTER_AUTHENTICATION_DUMMY_H_
 #define V8_EXECUTION_POINTER_AUTHENTICATION_DUMMY_H_
 
-#include "src/execution/pointer-authentication.h"
-
-#include "include/v8.h"
+#include "include/v8-internal.h"
 #include "src/base/macros.h"
-#include "src/common/globals.h"
+#include "src/execution/pointer-authentication.h"
 
 namespace v8 {
 namespace internal {
diff --git a/src/execution/pointer-authentication.h b/src/execution/pointer-authentication.h
index 8caf1d0b9dd..5052d928405 100644
--- a/src/execution/pointer-authentication.h
+++ b/src/execution/pointer-authentication.h
@@ -5,10 +5,9 @@
 #ifndef V8_EXECUTION_POINTER_AUTHENTICATION_H_
 #define V8_EXECUTION_POINTER_AUTHENTICATION_H_
 
-#include "include/v8.h"
+#include "include/v8-internal.h"
 #include "src/base/macros.h"
 #include "src/common/globals.h"
-#include "src/deoptimizer/deoptimizer.h"
 
 namespace v8 {
 namespace internal {
diff --git a/src/objects/feedback-vector.cc b/src/objects/feedback-vector.cc
index 5d4ddafda82..a47edf5ceea 100644
--- a/src/objects/feedback-vector.cc
+++ b/src/objects/feedback-vector.cc
@@ -4,6 +4,7 @@
 
 #include "src/objects/feedback-vector.h"
 
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/diagnostics/code-tracer.h"
 #include "src/heap/heap-inl.h"
 #include "src/heap/local-factory-inl.h"
diff --git a/src/runtime/runtime-debug.cc b/src/runtime/runtime-debug.cc
index d22e3b63948..edfeaa4780b 100644
--- a/src/runtime/runtime-debug.cc
+++ b/src/runtime/runtime-debug.cc
@@ -12,6 +12,7 @@
 #include "src/debug/debug-scopes.h"
 #include "src/debug/debug.h"
 #include "src/debug/liveedit.h"
+#include "src/deoptimizer/deoptimizer.h"
 #include "src/execution/arguments-inl.h"
 #include "src/execution/frames-inl.h"
 #include "src/execution/isolate-inl.h"
-- 
2.35.1

