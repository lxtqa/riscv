From 59d6465872bcda5d69029e9a15104e9d2adba697 Mon Sep 17 00:00:00 2001
From: Al Muthanna Athamina <almuthanna@chromium.org>
Date: Mon, 28 Aug 2023 12:06:36 +0200
Subject: [PATCH] [infra] Add bots for riscv64-pointer-compression

Bug: v8:14021
Change-Id: I59ef46c2e2554e9a1ae9814fd19e39bf61222f87
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/4813859
Reviewed-by: Michael Achenbach <machenbach@chromium.org>
Commit-Queue: Almothana Athamneh <almuthanna@chromium.org>
Cr-Commit-Position: refs/heads/main@{#89649}
---
 infra/mb/mb_config.pyl     |  7 +++++++
 infra/testing/builders.pyl | 21 +++++++++++++++++++++
 2 files changed, 28 insertions(+)

diff --git a/infra/mb/mb_config.pyl b/infra/mb/mb_config.pyl
index 56fa6ea08c7..b814d2b44f4 100644
--- a/infra/mb/mb_config.pyl
+++ b/infra/mb/mb_config.pyl
@@ -231,6 +231,7 @@
       # RISC-V
       'V8 Linux - riscv32 - sim - builder': 'release_simulate_riscv32',
       'V8 Linux - riscv64 - sim - builder': 'release_simulate_riscv64',
+      'V8 Linux - riscv64 - sim - pointer compression - builder': 'release_simulate_riscv64_pointer_compression',
       # Loongson
       'V8 Linux - loong64 - sim - builder': 'release_simulate_loong64',
     },
@@ -292,6 +293,7 @@
       'v8_linux64_msan_compile_rel': 'release_simulate_arm64_msan_minimal_symbols',
       'v8_linux_riscv32_compile_rel': 'release_simulate_riscv32',
       'v8_linux64_riscv64_compile_rel': 'release_simulate_riscv64',
+      'v8_linux64_riscv64_pointer_compression_compile_rel': 'release_simulate_riscv64_pointer_compression',
       'v8_linux64_tsan_compile_rel': 'release_x64_tsan_minimal_symbols',
       'v8_linux64_tsan_compile_dbg': 'debug_x64_tsan_minimal_symbols',
       'v8_linux64_tsan_no_cm_compile_rel': 'release_x64_tsan_no_cm',
@@ -478,6 +480,8 @@
       'release_bot', 'simulate_riscv32'],
     'release_simulate_riscv64': [
       'release_bot', 'simulate_riscv64'],
+    'release_simulate_riscv64_pointer_compression': [
+      'release_bot', 'simulate_riscv64', 'v8_enable_pointer_compression'],
     'release_simulate_s390x': [
       'release_bot', 'simulate_s390x'],
 
@@ -1069,6 +1073,9 @@
     'v8_disable_pointer_compression': {
       'gn_args': 'v8_enable_pointer_compression=false',
     },
+    'v8_enable_pointer_compression': {
+      'gn_args': 'v8_enable_pointer_compression=true',
+    },
     'v8_disable_pointer_compression_shared_cage': {
       'gn_args': 'v8_enable_pointer_compression_shared_cage=false',
     },
diff --git a/infra/testing/builders.pyl b/infra/testing/builders.pyl
index 2a787024370..2427dd33c8b 100644
--- a/infra/testing/builders.pyl
+++ b/infra/testing/builders.pyl
@@ -846,6 +846,14 @@
       {'name': 'v8testing', 'shards': 3},
     ],
   },
+  'v8_linux64_riscv64_pointer_compression_rel': {
+    'swarming_dimensions': {
+      'os': 'Ubuntu-22.04',
+    },
+    'tests': [
+      {'name': 'v8testing', 'shards': 3},
+    ],
+  },
   ##############################################################################
   # Odroids with native arm
   'v8_odroid_arm_rel': {
@@ -2372,6 +2380,19 @@
       {'name': 'v8testing', 'shards': 3},
     ],
   },
+  'V8 Linux - riscv64 - sim - pointer compression': {
+    'swarming_dimensions': {
+      'os': 'Ubuntu-22.04',
+    },
+    'swarming_task_attrs': {
+      'expiration': 14400,
+      'hard_timeout': 3600,
+      'priority': 35,
+    },
+    'tests': [
+      {'name': 'v8testing', 'shards': 3},
+    ],
+  },
   'V8 Linux - s390x - sim': {
     'swarming_dimensions': {
       'os': 'Ubuntu-22.04',
-- 
2.35.1

