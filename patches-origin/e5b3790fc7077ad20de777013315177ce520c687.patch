From e5b3790fc7077ad20de777013315177ce520c687 Mon Sep 17 00:00:00 2001
From: Lu Yahan <yahan@iscas.ac.cn>
Date: Mon, 9 Jan 2023 15:43:39 +0800
Subject: [PATCH] [riscv] Fix error for computing the slot size of element

Change-Id: I0dcfadc4cdddecb7d6cd601626a4e78a7560b581
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/4144628
Reviewed-by: ji qiu <qiuji@iscas.ac.cn>
Auto-Submit: Yahan Lu <yahan@iscas.ac.cn>
Commit-Queue: Yahan Lu <yahan@iscas.ac.cn>
Cr-Commit-Position: refs/heads/main@{#85150}
---
 src/compiler/backend/riscv/code-generator-riscv.cc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/compiler/backend/riscv/code-generator-riscv.cc b/src/compiler/backend/riscv/code-generator-riscv.cc
index 65f626b5f7..eba0797684 100644
--- a/src/compiler/backend/riscv/code-generator-riscv.cc
+++ b/src/compiler/backend/riscv/code-generator-riscv.cc
@@ -4765,7 +4765,7 @@ void CodeGenerator::AssembleSwap(InstructionOperand* source,
 
 AllocatedOperand CodeGenerator::Push(InstructionOperand* source) {
   auto rep = LocationOperand::cast(source)->representation();
-  int new_slots = RoundUp<2>(ElementSizeInPointers(rep));
+  int new_slots = ElementSizeInPointers(rep);
   RiscvOperandConverter g(this, nullptr);
   int last_frame_slot_id =
       frame_access_state_->frame()->GetTotalFrameSlotCount() - 1;
@@ -4793,7 +4793,7 @@ AllocatedOperand CodeGenerator::Push(InstructionOperand* source) {
 }
 
 void CodeGenerator::Pop(InstructionOperand* dest, MachineRepresentation rep) {
-  int new_slots = RoundUp<2>(ElementSizeInPointers(rep));
+  int new_slots = ElementSizeInPointers(rep);
   frame_access_state()->IncreaseSPDelta(-new_slots);
   RiscvOperandConverter g(this, nullptr);
   if (dest->IsRegister()) {
-- 
2.35.1

