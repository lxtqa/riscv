From 52e0a90dc38d1951e6a72b02ed5aba884f275f9a Mon Sep 17 00:00:00 2001
From: Lu Yahan <yahan@iscas.ac.cn>
Date: Thu, 17 Nov 2022 13:21:16 +0800
Subject: [PATCH] [riscv64] fmv_x_w should use sext32 to extend rd.

Change-Id: I808771e8792c74971be4a92399dddf8e7cd08ac8
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/4032017
Auto-Submit: Yahan Lu <yahan@iscas.ac.cn>
Commit-Queue: ji qiu <qiuji@iscas.ac.cn>
Reviewed-by: ji qiu <qiuji@iscas.ac.cn>
Cr-Commit-Position: refs/heads/main@{#84318}
---
 src/execution/riscv/simulator-riscv.cc | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/execution/riscv/simulator-riscv.cc b/src/execution/riscv/simulator-riscv.cc
index 334ce9fcf51..3d5d6ba10d0 100644
--- a/src/execution/riscv/simulator-riscv.cc
+++ b/src/execution/riscv/simulator-riscv.cc
@@ -4105,7 +4105,7 @@ void Simulator::DecodeRVRFPType() {
         case 0b000: {
           if (instr_.Rs2Value() == 0b00000) {
             // RO_FMV_X_W
-            set_rd(sext_xlen(get_fpu_register_word(rs1_reg())));
+            set_rd(sext32(get_fpu_register_word(rs1_reg())));
           } else {
             UNSUPPORTED();
           }
-- 
2.35.1

