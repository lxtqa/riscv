From b66334313c8bd73b253d0779f59f3e8656967043 Mon Sep 17 00:00:00 2001
From: Lu Yahan <yahan@iscas.ac.cn>
Date: Thu, 16 Dec 2021 16:41:44 +0800
Subject: [PATCH] [riscv64] use callee save register in regexp

Bug: v8:12502

Change-Id: I8d1b599fc945e276b70901953368768594470204
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/3343861
Reviewed-by: ji qiu <qiuji@iscas.ac.cn>
Commit-Queue: ji qiu <qiuji@iscas.ac.cn>
Cr-Commit-Position: refs/heads/main@{#78421}
---
 src/regexp/riscv64/regexp-macro-assembler-riscv64.cc | 6 +++---
 src/regexp/riscv64/regexp-macro-assembler-riscv64.h  | 6 +++---
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/regexp/riscv64/regexp-macro-assembler-riscv64.cc b/src/regexp/riscv64/regexp-macro-assembler-riscv64.cc
index cc527a5432..dda2104feb 100644
--- a/src/regexp/riscv64/regexp-macro-assembler-riscv64.cc
+++ b/src/regexp/riscv64/regexp-macro-assembler-riscv64.cc
@@ -23,10 +23,10 @@ namespace internal {
  * This assembler uses the following register assignment convention
  * - s3 : kScratchReg. Temporarily stores the index of capture start after a matching pass
  *        for a global regexp.
- * - a5 : Pointer to current Code object including heap object tag.
- * - a6 : Current position in input, as negative offset from end of string.
+ * - s4 : Pointer to current Code object including heap object tag.
+ * - s1 : Current position in input, as negative offset from end of string.
  *        Please notice that this is the byte offset, not the character offset!
- * - a7 : Currently loaded character. Must be loaded using
+ * - s2 : Currently loaded character. Must be loaded using
  *        LoadCurrentCharacter before using any of the dispatch methods.
  * - t0 : Points to tip of backtrack stack
  * - t1 : Unused.
diff --git a/src/regexp/riscv64/regexp-macro-assembler-riscv64.h b/src/regexp/riscv64/regexp-macro-assembler-riscv64.h
index 4692b67814..121569849a 100644
--- a/src/regexp/riscv64/regexp-macro-assembler-riscv64.h
+++ b/src/regexp/riscv64/regexp-macro-assembler-riscv64.h
@@ -155,10 +155,10 @@ class V8_EXPORT_PRIVATE RegExpMacroAssemblerRISCV
 
   // Register holding the current input position as negative offset from
   // the end of the string.
-  static constexpr Register current_input_offset() { return a6; }
+  static constexpr Register current_input_offset() { return s1; }
 
   // The register containing the current character after LoadCurrentCharacter.
-  static constexpr Register current_character() { return a7; }
+  static constexpr Register current_character() { return s2; }
 
   // Register holding address of the end of the input string.
   static constexpr Register end_of_input_address() { return t2; }
@@ -172,7 +172,7 @@ class V8_EXPORT_PRIVATE RegExpMacroAssemblerRISCV
   static constexpr Register backtrack_stackpointer() { return t0; }
 
   // Register holding pointer to the current code object.
-  static constexpr Register code_pointer() { return a5; }
+  static constexpr Register code_pointer() { return s4; }
 
   // Byte size of chars in the string to match (decided by the Mode argument).
   inline int char_size() const { return static_cast<int>(mode_); }
-- 
2.35.1

