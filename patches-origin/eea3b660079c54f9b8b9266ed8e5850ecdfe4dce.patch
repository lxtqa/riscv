From eea3b660079c54f9b8b9266ed8e5850ecdfe4dce Mon Sep 17 00:00:00 2001
From: Lu Yahan <yahan@iscas.ac.cn>
Date: Fri, 26 May 2023 10:16:29 +0800
Subject: [PATCH] [riscv]Fix riscv link failed.

Change-Id: I51fa9d867344061a3bc8f45a219bcb62c49f2c2e
Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/4568290
Reviewed-by: Ji Qiu <qiuji@iscas.ac.cn>
Commit-Queue: Ji Qiu <qiuji@iscas.ac.cn>
Auto-Submit: Yahan Lu <yahan@iscas.ac.cn>
Cr-Commit-Position: refs/heads/main@{#87873}
---
 src/compiler/backend/riscv/instruction-scheduler-riscv.cc  | 2 +-
 src/compiler/backend/riscv/instruction-selector-riscv64.cc | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/compiler/backend/riscv/instruction-scheduler-riscv.cc b/src/compiler/backend/riscv/instruction-scheduler-riscv.cc
index 289e564e00b..4d0ec6a1dc1 100644
--- a/src/compiler/backend/riscv/instruction-scheduler-riscv.cc
+++ b/src/compiler/backend/riscv/instruction-scheduler-riscv.cc
@@ -1343,7 +1343,7 @@ int InstructionScheduler::GetInstructionLatency(const Instruction* instr) {
     case kRiscvTst64:
 #endif
     case kRiscvTst32:
-      return AndLatency(instr->InputAt(1)->IsRegister());
+      return AndLatency(instr->InputAt(0)->IsRegister());
     case kRiscvRor32:
       return 1;
     case kRiscvMov:
diff --git a/src/compiler/backend/riscv/instruction-selector-riscv64.cc b/src/compiler/backend/riscv/instruction-selector-riscv64.cc
index a8309ec5d8f..823a3c118f1 100644
--- a/src/compiler/backend/riscv/instruction-selector-riscv64.cc
+++ b/src/compiler/backend/riscv/instruction-selector-riscv64.cc
@@ -3,6 +3,8 @@
 // found in the LICENSE file.
 
 #include "src/base/bits.h"
+#include "src/codegen/assembler-inl.h"
+#include "src/codegen/machine-type.h"
 #include "src/compiler/backend/instruction-selector-impl.h"
 #include "src/compiler/backend/riscv/instruction-selector-riscv.h"
 #include "src/compiler/node-matchers.h"
-- 
2.35.1

